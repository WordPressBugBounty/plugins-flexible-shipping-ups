!function(){"use strict";var e=window.wc.blocksCheckout,t=window.React;function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function o(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function a(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,a,r,l=[],c=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=a.call(n)).done)&&(l.push(i.value),l.length!==t);c=!0);}catch(e){s=!0,o=e}finally{try{if(!c&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(s)throw o}}return l}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var l=window.wp.element,c=window.wp.components,s=window.wp.i18n,u=window.wp.data,d=window.lodash,p=[{label:(0,s.__)("Please enter at least 3 characters","flexible-shipping-ups"),value:""}],m=function(e){var t=e.searchString,n=e.ajaxUrl,i=e.formData,o=e.setFilteredOptions,a=e.setFilteredValue,r=e.setPointId,l=e.pointId,c=new AbortController;fetch(n,{method:"POST",body:i,signal:c.signal}).then((function(e){if(200===e.status)return e.json();throw new Error("Invalid response status: "+e.statusText)})).then((function(e){var n=e.items.map((function(e){return{label:e.text,value:String(e.id)}}));o(n),a(t),r&&(l&&n.filter((function(e){return e.value===l})).length>0?r(l):r(n[0].value))})).catch((function(e){window.console.log(e)}))},f=function(e){var t=e.searchString,n=e.ajaxAction,i=e.nonce,o=new FormData;return o.append("action",n),o.append("security",i),o.append("city",t),o.append("s",t),o.append("search",t),o},b=function(e){var i,o,b,h,v,g,y,w,k=e.checkoutExtensionData,S=e.cart,x=e.metadata,_=e.showFieldCallback,E=e.requiredFieldCallback,C=e.formDataCallback,N=e.selectPointFromMapCallback,D=(0,l.useRef)(),j=wc.blocksCheckout.extensionCartUpdate,A=wcSettings[x.settingsKey],F=null!==(i=x.autoloadOptions)&&void 0!==i&&i,O=(k.extensionData,k.setExtensionData),I=A.integrationName+"-"+A.fieldName,P=(0,u.useDispatch)("wc/store/validation"),T=P.setValidationErrors,V=P.clearValidationError,R=(0,u.useDispatch)("wc/store/checkout"),U=R.__internalIncrementCalculating,q=R.__internalDecrementCalculating,M=r((0,l.useState)(!1),2),K=M[0],z=M[1],B=r((0,l.useState)([]),2),J=B[0],L=B[1],$=r((0,l.useState)(!1),2),G=$[0],H=$[1],Q=r((0,l.useState)(null!==(o=wcSettings.checkoutData.extensions[A.integrationName][A.fieldName])&&void 0!==o?o:""),2),W=Q[0],X=Q[1],Y=r((0,l.useState)(null!==(b=wcSettings.checkoutData.extensions[A.integrationName].disable_list_selection)&&void 0!==b&&b),2),Z=Y[0],ee=(Y[1],r((0,l.useState)(null!==(h=wcSettings.checkoutData.extensions[A.integrationName].disable_map_selection)&&void 0!==h&&h),2)),te=ee[0];ee[1],(0,l.useEffect)((function(){var e=function(){var e=[];return S.shippingRates.map((function(t){t.shipping_rates.filter((function(t){t.selected&&e.push(t)}))})),e}(),t=function(e){var t=[];return e.map((function(e){e.meta_data.some((function(e){return"_fs_method"===e.key&&e.value.method_integration===A.flexibleShippingIntegration&&t.push(e.value),!1}))})),t}(e);L(t),z(_(t,e)),H(E(t,e))}),a(S.shippingRates));var ne=(0,u.useSelect)((function(e){return e("wc/store/validation").getValidationError(I)})),ie=null!==(v=wcSettings.checkoutData.extensions[A.integrationName].field_label)&&void 0!==v?v:(0,s.__)("Selected pickup point","flexible-shipping-ups"),oe=null!==(g=wcSettings.checkoutData.extensions[A.integrationName].button_label)&&void 0!==g?g:(0,s.__)("Select from map","octolize-pickup-point-checkout-blocks");(0,l.useEffect)((function(){var e,t,i;O(A.integrationName,A.fieldName,W),K&&G&&0===W.length?T((e={},i={message:ie,hidden:!1},(t=function(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}(t=I))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e)):V(I)}),[W]),(0,l.useEffect)((function(){K&&G||V(I)}),[].concat(a(S.shippingRates),[G]));var ae=r((0,l.useState)(""),2),re=ae[0],le=ae[1],ce=function(e,t,n){return{searchString:e,ajaxUrl:A.ajaxUrl,formData:C(f({searchString:e,ajaxAction:A.ajaxAction,nonce:A.nonce}),J,S.shippingAddress),setFilteredOptions:de,setFilteredValue:le,setPointId:t,pointId:n}},se=r((0,l.useState)(F?[]:null!==(y=wcSettings.checkoutData.extensions[A.integrationName].default_options)&&void 0!==y?y:p),2),ue=se[0],de=se[1],pe=function(e){X(e),O(A.integrationName,A.fieldName,e),U(),j({namespace:A.integrationName,data:{point_id:e}}).finally((function(){q()}))},me=(0,l.useCallback)((0,d.debounce)((function(e){m(e)}),500),[m]);(0,l.useEffect)((function(){K&&F&&me(ce(""))}),a(S.shippingRates)),K&&F&&0===ue.length&&me(ce("",X,W));var fe=function(e){X(e.id),de([{label:e.label,value:e.id}]),pe(e.id)},be=function(e){e.preventDefault(),N({pointId:W,address:S.shippingAddress,setPointSelectedFromMap:fe,cart:S})};return(0,t.createElement)(t.Fragment,null,K&&(0,t.createElement)(t.Fragment,null,!Z&&(0,t.createElement)("div",{className:"wc-block-components-combobox is-active"},(0,t.createElement)(c.ComboboxControl,{className:"wc-block-components-combobox-control"+(!1===(null==ne?void 0:ne.hidden)?" has-error":""),label:ie,value:W,required:G,options:ue,filteredValue:re,onFilterValueChange:function(e){if(e.length){var t=(0,d.isObject)(D.current)?D.current.ownerDocument.activeElement:void 0;if(t&&(0,d.isObject)(D.current)&&D.current.contains(t))return;if(!F){if(e.length<3)return void de(p);me(ce(e))}}},onChange:pe,allowReset:!1,"aria-invalid":(null==ne?void 0:ne.message)&&!(null!=ne&&ne.hidden)}),!1===(null==ne?void 0:ne.hidden)&&(0,t.createElement)("div",{className:"wc-block-components-validation-error",role:"alert",style:{marginTop:"20px"}},(0,t.createElement)("p",{id:I},null==ne?void 0:ne.message))),Z&&(0,t.createElement)("div",{className:"wc-block-components-text-input is-active"},(0,t.createElement)(c.TextControl,{className:"wc-block-components-text-input"+(!1===(null==ne?void 0:ne.hidden)?" has-error":""),value:null===(w=ue[0])||void 0===w?void 0:w.label,label:ie,readOnly:!0,onClick:function(e){be(e)},"aria-invalid":(null==ne?void 0:ne.message)&&!(null!=ne&&ne.hidden)}),!1===(null==ne?void 0:ne.hidden)&&(0,t.createElement)("div",{className:"wc-block-components-validation-error",role:"alert",style:{marginTop:"20px"}},(0,t.createElement)("p",{id:I},null==ne?void 0:ne.message))),N&&!te&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:"wc-block-checkout__actions_row",style:{marginTop:Z?"20px":"40px",marginLeft:"10px"}},(0,t.createElement)("button",{className:"wc-block-components-button wp-element-button is-link",onClick:be},oe)))))},h=JSON.parse('{"apiVersion":2,"name":"flexible-shipping-ups/point-selection-block","version":"1.0.0","title":"Pickup point selection","category":"woocommerce","description":"Adds a block to select UPS pickup point","supports":{"html":false,"align":false,"multiple":false,"reusable":false},"parent":["woocommerce/checkout-shipping-methods-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"settingsKey":"flexible-shipping-ups_data","textdomain":"flexible-shipping-ups","autoloadOptions":true,"editorStyle":"file:../../../../build/style-point-selection-block.css"}'),v=function(e){var t=!1;return e.meta_data.map((function(e){"collection_point"===e.key&&"yes"===e.value&&(t=!0)})),t},g=function(e,t){var n=!1;return t.map((function(e){"flexible_shipping_ups"===e.method_id&&v(e)&&(n=!0)})),n},y=function(e,t){var n=!1;return e.map((function(e){"flexible_shipping_ups"===rate.method_id&&v(rate)&&(n=!0)})),n},w=function(e,t,n){return e.set("postcode",n.postcode),e.set("country",n.country),e.set("city",n.city),e.set("address",n.address_1),e.set("address_2",n.address_2),e};(0,e.registerCheckoutBlock)({metadata:h,component:function(e){var n=e.checkoutExtensionData,i=e.extensions,o=e.cart;return(0,t.createElement)(b,{checkoutExtensionData:n,extensions:i,cart:o,metadata:h,showFieldCallback:g,requiredFieldCallback:y,formDataCallback:w})}})}();